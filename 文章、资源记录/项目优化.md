## 1. Vite配置优化 
### 1.1 启用esbuild压缩以及其它配置

```javascript
export default defineConfig({
    // vite 的 build 构建配置，主要用于优化打包产物的体积，结构和加载性能
     build: {
      sourcemap: false, // 生产环境禁用SourceMap,关闭源码映射，打包后的代码无法调试因为是压缩过的
      minify: 'esbuild', // 启用esbuild压缩 JS/CSS 效果：压缩速度极快，产物体积小
      cssCodeSplit: true, // 开启 CSS 代码分割
       // 设置chunk大小警告限制，vite会在打包时给出警告，不影响打包结果
      chunkSizeWarningLimit: 2000,
      // 资源内联限制 小于设置值(如下 4KB)的图片、字体等资源会被 base64 内联到 JS/CSS中，减少请求次数
      assetsInlineLimit: 4096,
      esbuild: {
        minifyIdentifiers: true,
        // 移除console和debugger
        drop: ['console', 'debugger'] : [],
        // 目标版本 指定javascript 目标版本：1.控制代码转换的兼容性级别、2.影响最终输出的代码特性
        // 常用值：'es2015', 'es2016', 'es2017', 'es2018', 'es2019', 'es2020', 'esnext'（最新特性）
        target: 'es2020', 
        // 启用tree shaking 
        // 作用：移除未使用的代码，减少最终代码体积
        treeShaking: true,
        // 控制 esbuild 的日志输出级别：error(只显示错误信息) | warning(显示警告信息和错误) | info(显示全部信息)
        logLevel: 'error'
      },
      rollupOptions: {
        output: {
         manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          components: ['@/components'],
          utils: ['@/utils']
        }
      }
     },
    }
})
```

### 1.2 依赖预构建优化（关键性能优化）
optimizeDeps 是vite的依赖预购建配置，用于优化开发环境的启动速度和热更新速度
```javascript
optimizeDeps:{
  // 预构建依赖
  include:['vue', 'vue-router', 'pinia'],
  // 排除不需要构建的依赖
  exclude: ['vite-plugin-mock'],
  // 启用依赖缓存 false:只在依赖变化时重新构建，true:每次启动都重新构建(开发调试用)
  force: false
}
```

## 2. 项目体积优化 
### 2.1 组件按需加载
在路由配置中使用动态导入：

```javascript
// ... existing code ...
const routes = [
  {
    path: '/dashboard',
    name: 'Dashboard',
    component: () => import('@/views/dashboard/index.vue') // 动态导入
  }
  // ... existing code ...
]
``` 
### 2.2 优化静态资源
- 使用CDN加载大型静态资源
##  3. 构建性能优化 
### 3.1 启用多线程构建
首先下载插件： cnpm i -D vite-plugin-multi-thread
```javascript
// ... existing code ...
import multi from 'vite-plugin-multi-thread'

export default defineConfig({
  plugins: [
    // ... existing plugins ...
    multi()
  ],
  // ... existing code ...
})
``` 
### 3.2 利用缓存机制
```javascript
// ... existing code ...
export default defineConfig({
  cacheDir: 'node_modules/.vite-cache', // 自定义缓存目录
  // ... existing code ...
})
```
## 4. 高级优化策略 
### 4.1 分析打包体积
安装依赖分析工具：

```bash
npm install --save-dev rollup-plugin-visualizer
```
配置：

```javascript
// ... existing code ...
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    // ... existing plugins ...
    visualizer({
      open: true,
      filename: 'stats.html'  // 打包后的分析文件
    })
  ],
  // ... existing code ...
})
```
配置好之后运行命令即可：npm run build，打包后会生成一个 .html 文件，分析打包后的数据

## 使用 rollDown-vite 插件优化打包体积
项目环境要求 node 版本为 20+。

在package.json中配置如下：
```javascript
{
  "dependencies":{
    "vite": "npm:rolldown-vite@latest"
  }
}
```

- 注意：如果node版本比较低且安装了 rollDown-vite 插件要删除掉 node_modules 包和 pnpm-lock.yaml 文件，因为 pnpm-lock.yaml 在上一次低版本node安装了
插件并根据低版本node锁定了错误版本的插件，所以为了根据最新的环境安装合适的插件需要删掉pnpm-lock.yaml文件，以安装合适的插件版本。



## 5.vue3打包时长检测
在 PowerShell 中，你可以使用 `Measure-Command` 来测量命令的执行时间。以下是一个示例，展示了如何测量 `vite build` 命令的执行时间：

```powershell
Measure-Command { npm run build }
```
![image](https://cdn.nlark.com/yuque/0/2025/png/2488285/1751258099441-d8a46b2e-9d67-4a38-8cdd-79c2f4945416.png?x-oss-process=image%2Fformat%2Cwebp)
参数说明 表格

| 时间单位     | 值                  | 说明                                                                 |
| ------------ | ------------------- | -------------------------------------------------------------------- |
| Days         | 0                   | 该时间跨度对应的天数                                                 |
| Hours        | 0                   | 该时间跨度对应的天数                                                 |
| Minutes      | 3                   | 该时间跨度对应的分钟数 (取整)                                        |
| Seconds      | 11                  | 该时间跨度对应的秒数 (取整)                                          |
| Milliseconds | 605                 | 该时间跨度对应的毫秒数(取整)                                         |
| Ticks        | 1916053800          | Ticks是—个时间单位：1秒等于10000000，该值表示该时间跨度对应的Ticks数 |
| TotalDays    | 0.00221765486111111 | 该时间跨度对应的总天数                                               |
| TotalHours   | 0.0532237166666667  | 该时间跨度对应的总小时数                                             |
| TotalMinutes | 3.193423            | 该时间跨度对应的总分钟数                                             |
| TotalSeconds | 191.60538           | 该时间跨度对应的总秒数                                               |
综合来看，这些时间数据表示的时间宽度约为3分11秒605毫秒。
