## 1、阿里云购买域名
- 购买域名地址：https://wanwang.aliyun.com/domain/ 便宜的域名一年十几块钱都有
- 购买完之后进入域名控制台=》域名列表就可以看到刚购买的(刚购买的域名状态一般为待审核，这个审核时间一般几分钟就可以了)
- 域名需要和对应的ip关联系来，这样就能通过域名方位对应ip了，关联方式是如下如图所示的域名列表中的解析
![域名列表](https://cdn.nlark.com/yuque/0/2025/png/2488285/1756889977701-837235c9-2cde-41c2-9b33-0b4611731957.png?x-oss-process=image%2Fformat%2Cwebp)
域名解析
![域名解析](https://cdn.nlark.com/yuque/0/2025/png/2488285/1756890149889-dee9b1d2-739c-44ab-9d4c-72029f098acb.png?x-oss-process=image%2Fformat%2Cwebp)
![阿里云域名文档](https://help.aliyun.com/zh/dws/?spm=a2c4g.11186623.0.0.c829159e406Loh)

## 2、域名备案
### 2.1、个人备案
注意点：
- 需要填写个人真实信息
- 备案的云产品实例需要续费3个月或者以上，否则不能备案
- 注意第四步：需要上传和互联网备案信息真实性承诺书(打印模板出来，签名、写日期、按手印后上传文件照片)
![备案流程](https://cdn.nlark.com/yuque/0/2025/png/2488285/1758110267104-653c5ad1-d101-44fd-81e3-8c52d72a7a5b.png?x-oss-process=image%2Fformat%2Cwebp)

## 3.域名备案审核
[工业和信息化部政务服务平台](https://beian.miit.gov.cn/#/Integrated/index)：https://beian.miit.gov.cn/#/Integrated/index
### 3.1 租赁服务器初审
这个时间很快一般一天就可以
### 3.2 工信部终审
这个时间比较慢，一般需要一周

[在工信部查看通过审核的域名](https://beian.miit.gov.cn/)

## 4. SSL证书申请
### 4.1 阿里云申请SSL证书
阿里云服务器的话直接找到入口绑定需要申请SSL证书的域名提交即可，后面就是等待平台的签发，一般为 半个钟左右

### 4.2 申请通过后的阿里云证书查看和下载
![查看阿里云证书](https://cdn.nlark.com/yuque/0/2025/png/2488285/1758990366107-d37dafe8-6e46-4a7c-a49c-925af87a66b6.png?x-oss-process=image%2Fformat%2Cwebp)

### 4.3 淘宝面板配置阿里云证书
将上面一步下载的密钥和证书配置到淘宝面板对应的网页中，如下如所示
![淘宝面板部署SSL证书](https://cdn.nlark.com/yuque/0/2025/png/2488285/1758991053275-3f186599-c7fd-493a-89ea-655f2ba58e7f.png?x-oss-process=image%2Fformat%2Cwebp)


## 5. OSS对象云存储
### 5.1 对象存储OSS管理页面
地址(https://oss.console.aliyun.com/overview)

阿里云配置oos需要配置五项如下所示：
```bash
ALIYUN_ACCESS_KEY_ID="your ALIYUN_ACCESS_KEY_ID" ## 访问秘钥ID
ALIYUN_ACCESS_KEY_SECRET="your ALIYUN_ACCESS_KEY_SECRET" ## 访问秘钥Secret
ALIYUN_OSS_BUCKET="education-bucket-learn"  ## 存储空间名称
ALIYUN_OSS_REGION="oss-cn-shenzhen"  ## 地域节点,如：oss-cn-shanghai（华东2上海）
```

📋 四个配置项说明
1️⃣ ALIYUN_ACCESS_KEY_ID（访问密钥ID）
含义：你的阿里云账号身份标识
格式：24位字符串，如 LTAI5tAbCdEfGhIjKlMn
获取位置：控制台右上角 → 头像 → "AccessKey 管理"
2️⃣ ALIYUN_ACCESS_KEY_SECRET（访问密钥Secret）
含义：与ID配对的密钥，用于验证请求
格式：30位字符串
⚠️ 重要：只显示一次，创建后务必保存！
3️⃣ ALIYUN_OSS_BUCKET（存储空间名称）
含义：文件存储的容器名称
格式：自定义，如 my-education-files
获取位置：OSS控制台 → "创建 Bucket" → 自己命名
4️⃣ ALIYUN_OSS_REGION（地域节点）
含义：存储空间所在的地理位置
格式：如 oss-cn-shanghai（华东2上海）
获取位置：Bucket 列表 → 找到你的 Bucket → 查看"外网访问 Endpoint"
         例如：oss-cn-shanghai.aliyuncs.com,Region 就是：oss-cn-shanghai

服务端配置阿里云上传：

### 5.2 阿里云 OSS 上传图片和视频步骤

#### 一、准备工作

**1. 创建 Bucket（存储空间）**
- 登录 OSS 控制台：https://oss.console.aliyun.com/
- 点击"创建 Bucket"
- 填写 Bucket 名称（如：`my-app-uploads`）
- 选择地域（如：华东1-杭州）
- 读写权限：选择"公共读"（图片视频需要外网访问）或"私有"（需要签名访问）
- 点击"确定"

**2. 创建 RAM 子账号（安全起见）**
- 进入 RAM 控制台：https://ram.console.aliyun.com/
- 左侧菜单 → 身份管理 → 用户 → 创建用户
- 勾选"OpenAPI 调用访问"
- 保存 AccessKey ID 和 AccessKey Secret（只显示一次！）
- 为用户授权：添加权限 → 选择 `AliyunOSSFullAccess`

**3. 配置跨域（CORS）**（如果前端直传需要）
- OSS 控制台 → 选择 Bucket → 权限管理 → 跨域设置
- 添加规则：
  - 来源：`*` 或指定域名
  - 允许 Methods：`GET, POST, PUT, DELETE, HEAD`
  - 允许 Headers：`*`
  - 暴露 Headers：`ETag, x-oss-request-id`

---

#### 二、Node.js 后端上传（推荐）

**1. 安装 SDK**
```bash
npm install ali-oss
```

**2. 配置环境变量（.env）**
```bash
ALIYUN_ACCESS_KEY_ID="LTAI5tFxxxxxxxxxxxxxx"
ALIYUN_ACCESS_KEY_SECRET="3G8Mxxxxxxxxxxxxxxxxxxxxxk"
ALIYUN_OSS_BUCKET="my-app-uploads"
ALIYUN_OSS_REGION="oss-cn-hangzhou"
```

**3. 上传代码示例**
```javascript
const OSS = require('ali-oss');
const path = require('path');

// 初始化 OSS 客户端
const client = new OSS({
  region: process.env.ALIYUN_OSS_REGION,
  accessKeyId: process.env.ALIYUN_ACCESS_KEY_ID,
  accessKeySecret: process.env.ALIYUN_ACCESS_KEY_SECRET,
  bucket: process.env.ALIYUN_OSS_BUCKET,
});

// 上传文件
async function uploadFile(file) {
  try {
    // 生成文件名（避免重复）
    const fileName = `${Date.now()}-${file.originalname}`;
    const filePath = `uploads/${fileName}`; // OSS 中的路径
    
    // 上传到 OSS
    const result = await client.put(filePath, file.buffer);
    
    console.log('上传成功:', result.url);
    return result.url; // 返回访问地址
  } catch (error) {
    console.error('上传失败:', error);
    throw error;
  }
}

// 上传本地文件
async function uploadLocalFile(localFilePath) {
  const fileName = path.basename(localFilePath);
  const result = await client.put(`uploads/${fileName}`, localFilePath);
  return result.url;
}
```

**4. Express 路由示例（配合 multer）**
```javascript
const express = require('express');
const multer = require('multer');
const router = express.Router();

// 使用内存存储
const upload = multer({ storage: multer.memoryStorage() });

// 上传接口
router.post('/upload', upload.single('file'), async (req, res) => {
  try {
    const file = req.file;
    
    // 验证文件类型
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4'];
    if (!allowedTypes.includes(file.mimetype)) {
      return res.status(400).json({ error: '文件类型不支持' });
    }
    
    // 上传到 OSS
    const url = await uploadFile(file);
    
    res.json({ 
      success: true, 
      url: url,
      message: '上传成功' 
    });
  } catch (error) {
    res.status(500).json({ error: '上传失败' });
  }
});

module.exports = router;
```

---

#### 三、前端直传（可选，适合大文件）

**1. 获取签名（后端接口）**
```javascript
// 生成 OSS 签名（后端）
router.get('/oss/signature', (req, res) => {
  const date = new Date();
  date.setHours(date.getHours() + 1); // 签名1小时有效
  
  const policy = {
    expiration: date.toISOString(),
    conditions: [
      ['content-length-range', 0, 1048576000] // 最大1GB
    ]
  };
  
  const signature = client.calculatePostSignature(policy);
  
  res.json({
    accessKeyId: client.options.accessKeyId,
    policy: signature.policy,
    signature: signature.Signature,
    host: `https://${client.options.bucket}.${client.options.region}.aliyuncs.com`,
    expire: date.getTime()
  });
});
```

**2. 前端上传代码**
```javascript
// 前端直传（Vue/React）
async function uploadToOSS(file) {
  // 1. 获取签名
  const { data } = await axios.get('/api/oss/signature');
  
  // 2. 构建表单
  const formData = new FormData();
  const fileName = `uploads/${Date.now()}-${file.name}`;
  
  formData.append('key', fileName);
  formData.append('policy', data.policy);
  formData.append('OSSAccessKeyId', data.accessKeyId);
  formData.append('signature', data.signature);
  formData.append('file', file);
  
  // 3. 上传到 OSS
  await axios.post(data.host, formData);
  
  // 4. 返回访问地址
  return `${data.host}/${fileName}`;
}
```

---

#### 四、常见配置

**1. 文件大小限制**
```javascript
const upload = multer({
  storage: multer.memoryStorage(),
  limits: {
    fileSize: 100 * 1024 * 1024, // 限制100MB
  }
});
```

**2. 支持的文件类型**
```javascript
const ALLOWED_TYPES = {
  image: ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],
  video: ['video/mp4', 'video/avi', 'video/mov', 'video/quicktime'],
};
```

**3. 删除文件**
```javascript
async function deleteFile(fileName) {
  await client.delete(fileName);
  console.log('删除成功');
}
```

**4. 获取文件列表**
```javascript
async function listFiles() {
  const result = await client.list({
    prefix: 'uploads/', // 目录前缀
    'max-keys': 100     // 最多返回100个
  });
  return result.objects;
}
```

---

#### 五、注意事项

⚠️ **安全建议**
- ✅ 使用 RAM 子账号，不要用主账号 AccessKey
- ✅ AccessKey 不要提交到代码仓库（使用 .env 文件）
- ✅ 验证文件类型和大小，防止恶意上传
- ✅ 生产环境使用 HTTPS

💰 **费用相关**
- 存储费用：按存储量计费（约 0.12元/GB/月）
- 流量费用：外网下载流量（约 0.5元/GB）
- 请求费用：PUT/GET 请求次数（很便宜）

🎯 **性能优化**
- 图片建议压缩后再上传
- 视频大文件使用分片上传
- 使用 CDN 加速访问（绑定自定义域名）

---

#### 六、快速测试

```bash
# 安装依赖
npm install ali-oss

# 创建测试文件 test-upload.js
node test-upload.js
```

```javascript
// test-upload.js
const OSS = require('ali-oss');

const client = new OSS({
  region: 'oss-cn-hangzhou',
  accessKeyId: 'your-access-key-id',
  accessKeySecret: 'your-access-key-secret',
  bucket: 'your-bucket-name',
});

async function test() {
  // 上传本地文件
  const result = await client.put('test.jpg', './test.jpg');
  console.log('上传成功:', result.url);
}

test();
```

---

#### 参考文档
- 阿里云 OSS 文档：https://help.aliyun.com/product/31815.html
- Node.js SDK：https://help.aliyun.com/document_detail/32068.html
